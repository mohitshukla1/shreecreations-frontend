<!doctype html>
<!--
* Bootstrap Simple Admin Template
* Version: 2.1
* Author: Alexis Luna
* Website: https://github.com/alexis-luna/bootstrap-simple-admin-template
-->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Shree Creations</title>
    <link href="assets/vendor/fontawesome/css/fontawesome.min.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome/css/solid.min.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome/css/brands.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/master.css" rel="stylesheet">
    <link href="assets/vendor/flagiconcss/css/flag-icon.min.css" rel="stylesheet">
</head>

<body>
    <div class="wrapper">
        <nav id="sidebar">
            <div class="sidebar-header">
                <span style="color:gold">Shree Creations</span>
                <!-- <img src="assets/img/logo.jpg" height="20px" width="50px" alt="bootraper logo" class="app-logo"> -->
            </div>
            <ul class="list-unstyled components text-secondary">
                <li>
                    <a href="#uielementsmenu" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle no-caret-down">Sale</a>
                    <ul class="collapse list-unstyled" id="uielementsmenu">

                       <li>
                          <a href="sale.html">Sale Orders</a>
                       </li>
                       <li>
                        <a href="normalSale.html">Sale Orders (Normal)</a>
                     </li>
                     <li>
                        <a href="allSales.html">All Sales</a>
                     </li>

                    </ul>
                 </li>
                 <li>
                    <a href="#uielementsinventory" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle no-caret-down">Inventory</a>
                    <ul class="collapse list-unstyled" id="uielementsinventory">
                        <li>
                            <a href="inventory.html">Inventory</a>
                        </li>
                        <li>
                            <a href="allInventory.html">All Inventory</a>
                        </li>


                    </ul>
                </li>
                <li>
                    <a href="#uielementsReport" data-bs-toggle="collapse" aria-expanded="false" class="dropdown-toggle no-caret-down">Reports</a>
                    <ul class="collapse list-unstyled" id="uielementsReport">
                       <li>
                          <a href="saleReport.html">Sale Report</a>
                       </li>
                       <li>
                        <a href="customer.html">Customers</a>
                    </li>
                    </ul>
                 </li>
            </ul>
        </nav>
        <div id="body" class="active">

            <div class="pg-title">

                <h2 class="page-title">All Sales</h2>

            </div>
            <!-- end of navbar navigation -->
            <div class="content">



                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <div class="card">

                                <div class="card-body">

                                        <div class="row g-2">
                                            <div class="col">
                                                <label for="invoiceId" class="form-label sr-only"></label>
                                                <input name="invoiceId" id="invoiceId" type="text" placeholder="invoiceId" class="form-control">
                                            </div>
                                            <div class="col">
                                                <label for="phoneNumber" class="form-label sr-only">phoneNumber</label>
                                                <input type="text" name="phoneNumber" id="phoneNumber" placeholder="phoneNumber" class="form-control">
                                            </div>

                                            <div class="col">
                                                <label for="name" class="form-label sr-only">Name</label>
                                                <input type="text" name="name" id="name" placeholder="name" class="form-control">
                                            </div>
                                            <div class="col">
                                                <button  class="btn btn-primary" onclick="searchOrder()">search</button>
                                            </div>
                                        </div>

                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Name</th>
                                                    <th>Order No.</th>
                                                    <th>Phone No.</th>
                                                    <th>Total</th>
                                                    <th>paymentMode</th>
                                                    <th>Date</th>

                                                    <th>Invoice</th>
                                                    <th>Notes</th>
                                                    <th>Return</th>
                                                    <th>Downlaod</th>

                                                </tr>
                                            </thead>
                                            <tbody id="allordersBody">

                                            </tbody>
                                        </table>
                                        <div id="msg"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>


            </div>
        </div>
    </div>
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/datatables/datatables.min.js"></script>
    <script src="assets/js/initiate-datatables.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
         document.addEventListener('DOMContentLoaded', function() {
            getAllOrders();



            const startDateInput = document.getElementById("startDate");
            const endDateInput = document.getElementById("endDate");
            function fetchStats() {
                const startDate = startDateInput.value;
                const endDate = endDateInput.value;

                console.log("startDate",startDate,endDate)
                if (startDate && endDate) {

                    getSaleReport(startDate,endDate);
                }
            }
            startDateInput.addEventListener("change", fetchStats);
            endDateInput.addEventListener("change", fetchStats);

         });
        function getAllOrders() {
         const apiUrl = 'http://localhost:8080/api/orders';
         const method = 'GET';

         // Make the API call
         fetch(apiUrl, {
         method: method,
         headers: {
           'Content-Type': 'application/json',
         },

         })
         .then(response => response.json())
         .then(data => {
         // Handle the API response here
         console.log('API Response:', data);
         const tableBody = document.getElementById('allordersBody');
         let totalSale = 0;
         for(let x=0; x<data.length; x++){
            if(!data[x].return){
                totalSale = totalSale + Number(data[x].total);
            }

           const newIndex = tableBody.children.length + 1;

           let total = data[x].total;

           if(data[x].oldOrderId){
            total = total - data[x].advance;
           }
           const newRow = document.createElement('tr');
           newRow.innerHTML = `
           <td>${x+1}</td>
             <td>${data[x].customerName}</td>
             <td>${data[x].saleOrderNumber}</td>
             <td>${data[x].phoneNumber}</td>
             <td>${total}</td>
             <td>${data[x].paymentMode}</td>

             <td>${formatDate(data[x].createdAt)}</td>
             <td>${data[x].invoiceNumber}</td>
             <td style="
    width: 19%;
">${data[x].notes}</td>
             <td><a target="blank" href="returnOrder.html?id=${data[x]._id}" class="btn btn-info me-1">Return</a></td>

             <td><a target="blank" href="invoice.html?id=${data[x]._id}" class="btn btn-success me-1"><i class="fa fa-download"></i></a></td>
            `;

           tableBody.appendChild(newRow);
         }




         })
         .catch(error => {
         console.error('Error:', error);
         alert('Error fetching order. Please try again.');
         });
        }

        function getSaleReport(startDate,endDate) {



            const apiUrl = 'http://localhost:8080/api/orders/saleReport';
            const method = 'POST';
            const productData = {
                startDate,endDate
              };
              const tableBody = document.getElementById('allordersBody');
            $.ajax({
                url: apiUrl,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(productData),
                success: function(data) {
                    console.log('API Response:', data);

                },
                error: function(error) {
                  console.error('Error:', error);
                }
              });



        }


        function formatDate(inputDate) {
            const options = { year: 'numeric', month: 'short', day: '2-digit' };
            const formattedDate = new Date(inputDate).toLocaleDateString('en-In', options);
            return formattedDate;
        }

        function searchOrder() {
            const msg = document.getElementById('msg');
            msg.innerHTML = "";
            let invoiceId = $('#invoiceId').val();
            let phoneNumber = $('#phoneNumber').val();

            let name = $('#name').val();

            const apiUrl = 'http://localhost:8080/api/orders/searchOrder';
            const method = 'POST';
            const productData = {
                invoiceId,phoneNumber,name
              };
              const tableBody = document.getElementById('allordersBody');
            $.ajax({
                url: apiUrl,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(productData),
                success: function(data) {
                    if(data.length > 0){

                        tableBody.innerHTML = "";


                        for(let x=0; x<data.length; x++){

                            const newIndex = tableBody.children.length + 1;

                            const newRow = document.createElement('tr');
                            newRow.innerHTML = `

                            <td>${x+1}</td>
             <td>${data[x].customerName}</td>
             <td>${data[x].saleOrderNumber}</td>
             <td>${data[x].phoneNumber}</td>
             <td>${data[x].total}</td>
             <td>${data[x].paymentMode}</td>

             <td>${formatDate(data[x].createdAt)}</td>
             <td>${data[x].invoiceNumber}</td>
             <td style="
    width: 19%;
">${data[x].notes}</td>
             <td><a target="blank" href="returnOrder.html?id=${data[x]._id}" class="btn btn-info me-1">Return</a></td>

             <td><a target="blank" href="invoice.html?id=${data[x]._id}" class="btn btn-success me-1"><i class="fa fa-download"></i></a></td>
            `;

                            tableBody.appendChild(newRow);
                            }
                    }else{

                        tableBody.innerHTML = "";
                        msg.innerHTML = "<tr><td style='Width:100%'>No record Found<td></tr>"
                    }


                },
                error: function(error) {
                  console.error('Error:', error);
                  alert('Error submitting data. Please try again.');
                }
              });
        }

    </script>
</body>

</html>
